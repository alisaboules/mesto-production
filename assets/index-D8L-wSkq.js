(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const $=e=>{e.classList.toggle("card__like-button_is-active")},ee=e=>{e.remove()},te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),D=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r},c)=>{const s=te(),S=s.querySelector(".card__like-button"),w=s.querySelector(".card__like-count"),x=s.querySelector(".card__control-button_type_delete"),v=s.querySelector(".card__image"),Y=s.querySelector(".card__control-button_type_info");return v.src=e.link,v.alt=e.name,s.querySelector(".card__title").textContent=e.name,w.textContent=e.likes.length,e.likes.some(Z=>Z._id===c)&&$(S),o&&S.addEventListener("click",()=>{o(S,e._id,w)}),e.owner._id!==c?x.remove():n&&x.addEventListener("click",()=>{n(e._id,s)}),t&&v.addEventListener("click",()=>{t({name:e.name,link:e.link})}),r&&Y.addEventListener("click",()=>{r(e._id)}),s},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})};function re(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}function N(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function O(e,t,o){return t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(N(e,t,o),!0):(re(e,t,t.validationMessage,o),!1)}function ne(e,t){return e.some(o=>!O(o.closest("form"),o,t))}function W(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)}function ce(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}function le(e,t,o){ne(e,o)?W(t,o):ce(t,o)}function se(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.addEventListener("input",()=>{O(e,r,t),le(o,n,t)})})}function b(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{N(e,r,t)}),W(n,t)}function ae(e){document.querySelectorAll(e.formSelector).forEach(o=>{se(o,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"6b269da3-3f9a-4b82-8b35-763fae22a030","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ie=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),V=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u),ue=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(u),de=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u),pe=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u),me=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u),fe=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>u(o)),j=document.querySelector(".places__list"),C=document.querySelector(".popup_type_edit"),y=C.querySelector(".popup__form"),J=y.querySelector(".popup__input_type_name"),H=y.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),p=q.querySelector(".popup__form"),_e=p.querySelector(".popup__input_type_card-name"),ye=p.querySelector(".popup__input_type_url"),g=document.querySelector(".popup_type_image"),B=g.querySelector(".popup__image"),he=g.querySelector(".popup__caption"),Se=document.querySelector(".profile__edit-button"),ve=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),f=I.querySelector(".popup__form"),be=f.querySelector(".popup__input");let _;const P=document.querySelector(".popup_type_remove-card"),Ce=P.querySelector(".popup__form");let R=null,z=null;const A=document.querySelector(".popup_type_info"),M=A.querySelector(".popup__info"),T=A.querySelector(".popup__list"),qe=document.querySelector("#popup-info-definition-template").content,ge=document.querySelector("#popup-info-user-preview-template").content,K=({name:e,link:t})=>{B.src=t,B.alt=e,he.textContent=e,d(g)},Le=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),ue({name:J.value,about:H.value}).then(t=>{L.textContent=t.name,E.textContent=t.about,i(C)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},Ee=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),de({avatar:be.value}).then(t=>{k.style.backgroundImage=`url(${t.avatar})`,i(I)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},ke=e=>{e.preventDefault(),a(e.target,!0,"Создание...","Создать"),pe({name:_e.value,link:ye.value}).then(t=>{j.prepend(D(t,{onPreviewPicture:K,onLikeIcon:Q,onDeleteCard:G,onInfoClick:X},_)),i(q)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Создание...","Создать")})},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ae(h);y.addEventListener("submit",Le);p.addEventListener("submit",ke);f.addEventListener("submit",Ee);Se.addEventListener("click",()=>{J.value=L.textContent,H.value=E.textContent,b(y,h),d(C)});k.addEventListener("click",()=>{f.reset(),b(f,h),d(I)});ve.addEventListener("click",()=>{p.reset(),b(p,h),d(q)});const Ie=document.querySelectorAll(".popup");Ie.forEach(e=>{oe(e)});Promise.all([V(),ie()]).then(([e,t])=>{L.textContent=t.name,E.textContent=t.about,k.style.backgroundImage=`url(${t.avatar})`,_=t._id,e.forEach(o=>{j.append(D(o,{onPreviewPicture:K,onLikeIcon:Q,onDeleteCard:G,onInfoClick:X},_))})}).catch(e=>{console.log(e)});Ce.addEventListener("submit",e=>{e.preventDefault(),a(e.target,!0,"Удаление...","Да"),me(R).then(()=>{ee(z),i(P)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Удаление...","Да")})});const G=(e,t)=>{R=e,z=t,d(P)},Q=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");fe(t,n).then(r=>{o.textContent=r.likes.length,r.likes.some(c=>c._id===_)!==n&&$(e)}).catch(r=>{console.log(r)})},a=(e,t,o,n)=>{const r=e.querySelector(".popup__button");r.textContent=t?o:n},Pe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),U=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},m=function(e,t){const o=qe.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},X=e=>{V().then(t=>{const o=t.find(n=>n._id===e);o&&(U(M),U(T),M.append(m("Описание:",o.name),m("Дата создания:",Pe(new Date(o.createdAt))),m("Владелец:",o.owner.name),m("Количество лайков:",o.likes.length)),o.likes.length&&o.likes.forEach(n=>{const r=ge.querySelector("li").cloneNode(!0);r.textContent=n.name,T.append(r)}),d(A))}).catch(t=>{console.log(t)})};

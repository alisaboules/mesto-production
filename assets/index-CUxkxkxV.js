(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const Y=e=>{e.classList.toggle("card__like-button_is-active")},Z=e=>{e.remove()},ee=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r},c)=>{const s=ee(),A=s.querySelector(".card__like-button"),w=s.querySelector(".card__like-count"),x=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),X=s.querySelector(".card__control-button_type_info");return S.src=e.link,S.alt=e.name,s.querySelector(".card__title").textContent=e.name,w.textContent=e.likes.length,o&&A.addEventListener("click",()=>{o(A,e._id,w)}),e.owner._id!==c?x.remove():n&&x.addEventListener("click",()=>{n(e._id,s)}),t&&S.addEventListener("click",()=>{t({name:e.name,link:e.link})}),r&&X.addEventListener("click",()=>{r(e._id)}),s},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},te=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})};function oe(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}function F(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function N(e,t,o){return t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(F(e,t,o),!0):(oe(e,t,t.validationMessage,o),!1)}function re(e,t){return e.some(o=>!N(o.closest("form"),o,t))}function O(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)}function ne(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}function ce(e,t,o){re(e,o)?O(t,o):ne(t,o)}function le(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.addEventListener("input",()=>{N(e,r,t),ce(o,n,t)})})}function v(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{F(e,r,t)}),O(n,t)}function se(e){document.querySelectorAll(e.formSelector).forEach(o=>{le(o,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"6b269da3-3f9a-4b82-8b35-763fae22a030","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ae=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),W=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u),ie=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(u),ue=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u),de=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u),pe=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u),me=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>u(o)),V=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),y=b.querySelector(".popup__form"),j=y.querySelector(".popup__input_type_name"),J=y.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),p=C.querySelector(".popup__form"),fe=p.querySelector(".popup__input_type_card-name"),_e=p.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),B=q.querySelector(".popup__image"),ye=q.querySelector(".popup__caption"),he=document.querySelector(".profile__edit-button"),Se=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),f=k.querySelector(".popup__form"),ve=f.querySelector(".popup__input");let _;const I=document.querySelector(".popup_type_remove-card"),be=I.querySelector(".popup__form");let H=null,R=null;const P=document.querySelector(".popup_type_info"),U=P.querySelector(".popup__info"),M=P.querySelector(".popup__list"),Ce=document.querySelector("#popup-info-definition-template").content,qe=document.querySelector("#popup-info-user-preview-template").content,z=({name:e,link:t})=>{B.src=t,B.alt=e,ye.textContent=e,d(q)},ge=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),ie({name:j.value,about:J.value}).then(t=>{g.textContent=t.name,L.textContent=t.about,i(b)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},Le=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),ue({avatar:ve.value}).then(t=>{E.style.backgroundImage=`url(${t.avatar})`,i(k)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},Ee=e=>{e.preventDefault(),a(e.target,!0,"Создание...","Создать"),de({name:fe.value,link:_e.value}).then(t=>{V.prepend($(t,{onPreviewPicture:z,onLikeIcon:G,onDeleteCard:K,onInfoClick:Q},_)),i(C)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Создание...","Создать")})},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};se(h);y.addEventListener("submit",ge);p.addEventListener("submit",Ee);f.addEventListener("submit",Le);he.addEventListener("click",()=>{j.value=g.textContent,J.value=L.textContent,v(y,h),d(b)});E.addEventListener("click",()=>{f.reset(),v(f,h),d(k)});Se.addEventListener("click",()=>{p.reset(),v(p,h),d(C)});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{te(e)});Promise.all([W(),ae()]).then(([e,t])=>{g.textContent=t.name,L.textContent=t.about,E.style.backgroundImage=`url(${t.avatar})`,_=t._id,e.forEach(o=>{V.append($(o,{onPreviewPicture:z,onLikeIcon:G,onDeleteCard:K,onInfoClick:Q},_))})}).catch(e=>{console.log(e)});be.addEventListener("submit",e=>{e.preventDefault(),a(e.target,!0,"Удаление...","Да"),pe(H).then(()=>{Z(R),i(I)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Удаление...","Да")})});const K=(e,t)=>{H=e,R=t,d(I)},G=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");me(t,n).then(r=>{o.textContent=r.likes.length,r.likes.some(c=>c._id===_)!==n&&Y(e)}).catch(r=>{console.log(r)})},a=(e,t,o,n)=>{const r=e.querySelector(".popup__button");r.textContent=t?o:n},Ie=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),T=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},m=function(e,t){const o=Ce.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Q=e=>{W().then(t=>{const o=t.find(n=>n._id===e);o&&(T(U),T(M),U.append(m("Описание:",o.name),m("Дата создания:",Ie(new Date(o.createdAt))),m("Владелец:",o.owner.name),m("Количество лайков:",o.likes.length)),o.likes.length&&o.likes.forEach(n=>{const r=qe.querySelector("li").cloneNode(!0);r.textContent=n.name,M.append(r)}),d(P))}).catch(t=>{console.log(t)})};

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const Z=e=>{e.classList.toggle("card__like-button_is-active")},ee=e=>{e.remove()},te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r},c)=>{const s=te(),h=s.querySelector(".card__like-button"),w=s.querySelector(".card__like-count"),x=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),X=s.querySelector(".card__control-button_type_info");return S.src=e.link,S.alt=e.name,s.querySelector(".card__title").textContent=e.name,w.textContent=e.likes.length,e.likes.some(Y=>Y._id===c)&&h.classList.add("card__like-button_is-active"),h.addEventListener("click",()=>o(h,e._id,w)),e.owner._id!==c?x.remove():n&&x.addEventListener("click",()=>{n(e._id,s)}),t&&S.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&X.addEventListener("click",()=>{r(e._id)}),s},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})};function re(e,t,o,n){const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}function F(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function N(e,t,o){return t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?(F(e,t,o),!0):(re(e,t,t.validationMessage,o),!1)}function ne(e,t){return e.some(o=>!N(o.closest("form"),o,t))}function O(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)}function ce(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}function le(e,t,o){ne(e,o)?O(t,o):ce(t,o)}function se(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.addEventListener("input",()=>{N(e,r,t),le(o,n,t)})})}function b(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{F(e,r,t)}),O(n,t)}function ae(e){document.querySelectorAll(e.formSelector).forEach(o=>{se(o,e)})}const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"6b269da3-3f9a-4b82-8b35-763fae22a030","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ie=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),W=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u),ue=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(u),de=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u),pe=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u),me=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u),fe=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>u(o)),V=document.querySelector(".places__list"),C=document.querySelector(".popup_type_edit"),_=C.querySelector(".popup__form"),j=_.querySelector(".popup__input_type_name"),J=_.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_new-card"),p=L.querySelector(".popup__form"),_e=p.querySelector(".popup__input_type_card-name"),ye=p.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),B=q.querySelector(".popup__image"),he=q.querySelector(".popup__caption"),Se=document.querySelector(".profile__edit-button"),ve=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),f=I.querySelector(".popup__form"),be=f.querySelector(".popup__input");let v;const P=document.querySelector(".popup_type_remove-card"),Ce=P.querySelector(".popup__form");let H=null,R=null;const A=document.querySelector(".popup_type_info"),M=A.querySelector(".popup__info"),T=A.querySelector(".popup__list"),Le=document.querySelector("#popup-info-definition-template").content,qe=document.querySelector("#popup-info-user-preview-template").content,z=({name:e,link:t})=>{B.src=t,B.alt=e,he.textContent=e,d(q)},ge=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),ue({name:j.value,about:J.value}).then(t=>{g.textContent=t.name,E.textContent=t.about,i(C)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},Ee=e=>{e.preventDefault(),a(e.target,!0,"Сохранение...","Сохранить"),de({avatar:be.value}).then(t=>{k.style.backgroundImage=`url(${t.avatar})`,i(I)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Сохранение...","Сохранить")})},ke=e=>{e.preventDefault(),a(e.target,!0,"Создание...","Создать"),pe({name:_e.value,link:ye.value}).then(t=>{V.prepend($(t,{onPreviewPicture:z,onLikeIcon:G,onDeleteCard:K,onInfoClick:Q},v)),i(L)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Создание...","Создать")})},y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ae(y);_.addEventListener("submit",ge);p.addEventListener("submit",ke);f.addEventListener("submit",Ee);Se.addEventListener("click",()=>{j.value=g.textContent,J.value=E.textContent,b(_,y),d(C)});k.addEventListener("click",()=>{f.reset(),b(f,y),d(I)});ve.addEventListener("click",()=>{p.reset(),b(p,y),d(L)});const Ie=document.querySelectorAll(".popup");Ie.forEach(e=>{oe(e)});Promise.all([W(),ie()]).then(([e,t])=>{g.textContent=t.name,E.textContent=t.about,k.style.backgroundImage=`url(${t.avatar})`,v=t._id,e.forEach(o=>{V.append($(o,{onPreviewPicture:z,onLikeIcon:G,onDeleteCard:K,onInfoClick:Q},v))})}).catch(e=>{console.log(e)});Ce.addEventListener("submit",e=>{e.preventDefault(),a(e.target,!0,"Удаление...","Да"),me(H).then(()=>{ee(R),i(P)}).catch(t=>{console.log(t)}).finally(()=>{a(e.target,!1,"Удаление...","Да")})});const K=(e,t)=>{H=e,R=t,d(P)},G=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");fe(t,n).then(r=>{o.textContent=r.likes.length,Z(e)}).catch(r=>console.log(r))},a=(e,t,o,n)=>{const r=e.querySelector(".popup__button");r.textContent=t?o:n},Pe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),U=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},m=function(e,t){const o=Le.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Q=e=>{W().then(t=>{const o=t.find(n=>n._id===e);o&&(U(M),U(T),M.append(m("Описание:",o.name),m("Дата создания:",Pe(new Date(o.createdAt))),m("Владелец:",o.owner.name),m("Количество лайков:",o.likes.length)),o.likes.length&&o.likes.forEach(n=>{const r=qe.querySelector("li").cloneNode(!0);r.textContent=n.name,T.append(r)}),d(A))}).catch(t=>{console.log(t)})};
